---
- name: Install Epel and Rmi
  dnf:
    name:
      [
        'https://dl.fedoraproject.org/pub/epel/epel-release-latest-{{ ansible_distribution_major_version }}.noarch.rpm',
        'http://rpms.famillecollet.com/enterprise/remi-release-{{ ansible_distribution_major_version }}.rpm',
      ]
    state: installed
  become: yes

- name: Import EPEL GPG key.
  rpm_key:
    key: /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-{{ ansible_distribution_major_version }}
    state: present
  become: yes

- name: Import remi GPG key.
  rpm_key:
    key: http://rpms.remirepo.net/RPM-GPG-KEY-remi
    state: present
  become: yes

- name: Set Rmi Version
  shell: dnf module enable php:remi-7.4 -y
  become: yes

- name: Install Packages
  dnf:
    state: installed
    name:
      [
        'php',
        'php-cli',
        'php-common',
        'php-fpm',
        'php-dom',
        'php-simplexml',
        'php-xml',
        'php-xmlreader',
        'php-curl',
        'php-date',
        'php-exif',
        'php-filter',
        'php-ftp',
        'php-gd',
        'php-hash',
        'php-iconv',
        'php-json',
        'php-libxml',
        'php-pecl-imagick',
        'php-mbstring',
        'php-mysqlnd',
        'php-openssl',
        'php-pcre',
        'php-posix',
        'php-sockets',
        'php-spl',
        'php-tokenizer',
        'php-zlib',
        'httpd',
      ]
  become: yes

- name: Change file ownership, group and permissions vagrant for php
  file:
    path: '{{ http_path }}'
    owner: vagrant
    group: vagrant
    mode: '0775'
  become: yes

- name: Change file ownership, group and permissions vagrant for Apache
  file:
    path: '{{ http_conf }}'
    owner: vagrant
    group: vagrant
  become: yes

- name: Change file permissions for wordpress
  file:
    path: '{{ wp_path }}'
    owner: apache
    recurse: yes
  become: yes
